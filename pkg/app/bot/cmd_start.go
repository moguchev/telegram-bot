package bot

import (
	tgbotapi "github.com/go-telegram-bot-api/telegram-bot-api/v5"
	"github.com/moguchev/telegram-bot/pkg/app/bot/storage"
	"github.com/moguchev/telegram-bot/pkg/logger"
)

const (
	startMsg = `
<b>–ß—Ç–æ —É–º–µ–µ—Ç –±–æ—Ç?</b>
1. üîî –ü—Ä–∏—Å—ã–ª–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö –æ—Ç–∑—ã–≤–∞—Ö ‚≠êÔ∏è –∏ –≤–æ–ø—Ä–æ—Å–∞—Ö ‚ùì –≤ –≤–∞—à–∏—Ö –∫–∞—Ä—Ç–æ—á–∫–∞—Ö —Ç–æ–≤–∞—Ä–æ–≤.
`
	noAPIKeyMsg = `
<b>–û—Ç–ø—Ä–∞–≤—å—Ç–µ –±–æ—Ç—É x64 API –∫–ª—é—á –∏–∑ –≤–∞—à–µ–≥–æ –ª–∏—á–Ω–æ–≥–æ –∫–∞–±–∏–Ω–µ—Ç–∞ –ø—Ä–æ–¥–∞–≤—Ü–∞.</b>

<b>–ß—Ç–æ —Ç–∞–∫–æ–µ API-–ö–ª—é—á –∏ –∫–∞–∫ –µ–≥–æ –ø–æ–ª—É—á–∏—Ç—å?</b>
API-–∫–ª—é—á ‚Äî —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á, –∫–æ—Ç–æ—Ä—ã–π Wildberries –≤—ã–¥–∞–µ—Ç —Å–≤–æ–∏–º –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞–º –∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Å —Å–µ—Ä–≤–µ—Ä–æ–≤ Wildberries –±–µ–∑ –¥–æ—Å—Ç—É–ø–∞ –∫ –≤–∞—à–µ–º—É –ª–∏—á–Ω–æ–º—É –∫–∞–±–∏–Ω–µ—Ç—É.
–ù–∞–π—Ç–∏ –µ–≥–æ –º–æ–∂–Ω–æ –≤ —Ä–∞–∑–¥–µ–ª–µ ¬´<a href="https://seller.wildberries.ru/supplier-settings/access-to-api">–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å ‚Äì –î–æ—Å—Ç—É–ø –∫ API</a>¬ª. –≠—Ç–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ, –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –Ω–∞–¥–µ–∂–Ω–æ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ã –∏ –Ω–∏–∫–æ–º—É –Ω–µ –¥–æ—Å—Ç—É–ø–Ω—ã.

–î–æ—Å—Ç—É–ø –ø–æ API-–∫–ª—é—á—É ‚Äî —ç—Ç–æ <b>—Å–∞–º—ã–π –±–µ–∑–æ–ø–∞—Å–Ω—ã–π —Å–ø–æ—Å–æ–± –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö</b>. –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—è –Ω–∞–º –í–∞—à API –∫–ª—é—á –º—ã –ø–æ–ª—É—á–∞–µ–º –¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –Ω–∞ –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ—Ö –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–µ —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –ø–æ–ª—É—á–∏—Ç—å Wildberries (–Ω–∞–ø—Ä–∏–º–µ—Ä: –∑–∞–∫–∞–∑—ã, –ø—Ä–æ–¥–∞–∂–∏, –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è, –Ω–∞–ª–∏—á–∏—é –Ω–∞ —Å–∫–ª–∞–¥–∞—Ö).`
)

func (b *bot) StartCmd(upd tgbotapi.Update) {
	const api = "StartCmd"

	b.sendMessage(upd.Message.Chat.ID, startMsg, true)

	var (
		chatID = upd.Message.Chat.ID
		id     = storage.ChatID(chatID)
	)

	ch, err := b.chats.GetChat(id)
	if err != nil {
		logger.ErrorKV(api,
			"action", "GetChat",
			"error", err,
		)
		return
	}

	if ch.GetToken() == "" {
		b.sendMessage(upd.Message.Chat.ID, noAPIKeyMsg, true)
	}
}
